<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="DJoz Template" />
    <meta name="keywords" content="DJoz, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Midnight | Videos</title>

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      type="text/css"
    />
    <link rel="stylesheet" href="css/barfiller.css" type="text/css" />
    <link rel="stylesheet" href="css/nowfont.css" type="text/css" />
    <link rel="stylesheet" href="css/rockville.css" type="text/css" />
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css">
</head>  <body>
    <!-- Page Preloder -->
    <div id="preloder">
      <div class="loader"></div>
    </div>

    <!-- Header Section Begin -->
    <header class="header">
      <div class="container">
        <div class="row">
          <div class="col-lg-2 col-md-2">
            <div class="header__logo">
              <a href="./index.html"><img src="img/logo-midnight.png" alt /></a>
            </div>
          </div>
          <div class="col-lg-10 col-md-10">
            <div class="header__nav">
              <nav class="header__menu mobile-menu">
                <ul>
                  <li><a href="./index.html">Home</a></li>
                  <li><a href="index.html#about">Nosotros</a></li>
                  <li class="active"><a href="./videos.html">Videos</a></li>
                  <li><a href="./contact.html">Contacto</a></li>
                </ul>
              </nav>
              <div class="header__right__social">
                <a
                  href="https://www.facebook.com/midnightvallarta"
                  target="_blank"
                  ><i class="fab fa-facebook"></i
                ></a>
                <a
                  href="https://www.threads.com/@midnight_vallarta"
                  target="_blank"
                  ><i class="fa fa-at"></i
                ></a>
                <a
                  href="https://www.instagram.com/midnight_vallarta"
                  target="_blank"
                  ><i class="fab fa-instagram"></i
                ></a>
                <a
                  href="https://www.tiktok.com/@midnight_rockband"
                  target="_blank"
                  ><i class="fab fa-tiktok"></i
                ></a>
                <a href="https://wa.me/523348751226" target="_blank"
                  ><i class="fab fa-whatsapp"></i
                ></a>
              </div>
            </div>
          </div>
        </div>
        <div id="mobile-menu-wrap"></div>
      </div>
    </header>
    <!-- Header Section End -->

    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option" style="margin-top: 180px">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="breadcrumb__links">
              <a href="./index.html"><i class="fa fa-home"></i> Home</a>
              <span>Videos</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Video Section Begin -->
    <section class="videos spad">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="section-title center-title">
              <h2>Videos</h2>
              <h1>Midnight Videos</h1>
            </div>

            <!-- Video principal se cargará dinámicamente -->
            <div id="main-video-container">
              <!-- Loading placeholder -->
              <div
                class="videos__large__item"
                style="
                  background: linear-gradient(45deg, #1a1a1a, #333);
                  min-height: 300px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                "
              >
                <div class="videos__large__item__text">
                  <h4>Cargando videos...</h4>
                  <ul>
                    <li>00:00</li>
                    <li>Cargando...</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Galería de videos se cargará dinámicamente -->
              <div class="videos__slider owl-carousel">
                <!-- Los videos se cargarán aquí dinámicamente -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Video Section End -->

    <!-- Video Modal -->
    <div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="videoModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content bg-dark">
          <div class="modal-header border-secondary">
            <h5 class="modal-title text-white" id="videoModalLabel">Video de Midnight</h5>
            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body p-0">
            <div id="video-container" style="position: relative; width: 100%;">
              <!-- Video embed se cargará aquí -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Section Begin -->
    <footer
      class="footer footer--normal spad set-bg"
      data-setbg="img/footer-bg.png"
    >
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-6">
            <div class="footer__address">
              <ul>
                <li>
                  <a href="https://wa.me/523348751226" target="_blank"
                    ><i class="fab fa-whatsapp"></i
                  ></a>
                  <p>WhatsApp</p>
                  <h6>+52 33 4875 1226</h6>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-4 offset-lg-1 col-md-6">
            <div class="footer__social">
              <h2>Midnight Rock Band</h2>
              <div class="footer__social__links">
                <a
                  href="https://www.facebook.com/midnightvallarta"
                  target="_blank"
                  ><i class="fab fa-facebook"></i
                ></a>
                <a
                  href="https://www.threads.com/@midnight_vallarta"
                  target="_blank"
                  ><i class="fab fa-at"></i
                ></a>
                <a
                  href="https://www.instagram.com/midnight_vallarta"
                  target="_blank"
                  ><i class="fab fa-instagram"></i
                ></a>
                <a
                  href="https://www.tiktok.com/@midnight_rockband"
                  target="_blank"
                  ><i class="fab fa-tiktok"></i
                ></a>
              </div>
            </div>
          </div>
          <div class="col-lg-3 offset-lg-1 col-md-6">
            <div class="col-lg-3 col-md-6">
              <div class="footer__address">
                <ul>
                  <li>
                    <a href="mailto:rockbandmight@gmail.com" target="_blank"
                      ><i class="fas fa-envelope"></i
                    ></a>
                    <p>Email</p>
                    <h6>rockbandmight@gmail.com</h6>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
        <div class="footer__copyright__text">
          <p>
            Created by
            <a href="https://vmdjtech.com" target="_blank">VM Technologies</a>
          </p>
        </div>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
      </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.barfiller.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>

    <!-- Music Plugin -->
    <script src="js/jquery.jplayer.min.js"></script>
    <script src="js/jplayerInit.js"></script>

    <!-- Facebook SDK for JavaScript según documentación oficial -->
    <div id="fb-root"></div>
    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v18.0"
    ></script>

    <script>
      $(document).ready(function () {
        async function fetchFacebookVideos() {
          try {
            console.log("Iniciando fetch de videos de Facebook...");
            const response = await fetch(
              "https://graph.facebook.com/v21.0/103385769279634/videos?fields=id,title,description,permalink_url,picture,created_time,length,privacy,status&access_token=EAAS9YN8phVIBP1MRmKQv5jZB497LMqbvznbsyhKCJX3Y1tbIfHhxbcAlgR0ZBOeMZBkXAX4v4ZCJuuJtKNb2KA93zwSjaIGeFBiVnkAy5WxbIunhqiziEDZAgS9V3qpDkGCp5bmxtZCBlDdj0m7mkzJrL8ZBRIbrzbZB03pPOIr45IEFesiL6oGNO6CyOsXAObvlDslUr58ZD"
            );

            if (!response.ok) {
              console.error(
                "Error en la respuesta:",
                response.status,
                response.statusText
              );
              return [];
            }

            const data = await response.json();
            console.log("Datos recibidos de Facebook:", data);

            if (data.error) {
              console.error("Error de Facebook API:", data.error);
              return [];
            }

            return data.data || [];
          } catch (error) {
            console.error("Error fetching Facebook videos:", error);
            return [];
          }
        }

        function formatDuration(seconds) {
          if (!seconds) return "00:00";
          const hours = Math.floor(seconds / 3600);
          const minutes = Math.floor((seconds % 3600) / 60);
          const secs = Math.floor(seconds % 60);

          if (hours > 0) {
            return `${hours.toString().padStart(2, "0")}:${minutes
              .toString()
              .padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
          }
          return `${minutes
            .toString()
            .padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
        }

        function formatDate(dateString) {
          const date = new Date(dateString);
          const options = { year: "numeric", month: "short", day: "numeric" };
          return date.toLocaleDateString("en-US", options);
        }

        function createVideoElement(video, isLarge = false) {
          const title =
            video.title ||
            video.description?.substring(0, 80) + "..." ||
            "Video de Midnight";
          const duration = formatDuration(video.length);
          const date = formatDate(video.created_time);
          const thumbnail = video.picture || "img/videos/default-video.jpg";

          // Crear URL para embed de Facebook
          let embedUrl = '';
          if (video.id) {
            // URL para embed de Facebook que funciona en iframe
            embedUrl = `https://www.facebook.com/plugins/video.php?height=400&href=https://www.facebook.com/watch/?v=${video.id}&show_text=false&width=560&t=0`;
          }

          console.log("Video ID:", video.id);
          console.log("Embed URL:", embedUrl);
          console.log("Privacy:", video.privacy);
          console.log("Status:", video.status);

          if (isLarge) {
            return `
              <div class="videos__large__item set-bg" data-setbg="${thumbnail}">
                <a href="#" 
                   data-video-title="${title}"
                   data-embed-url="${embedUrl}"
                   class="play-btn video-embed-btn" 
                   title="Reproducir video"
                   data-toggle="modal" 
                   data-target="#videoModal">
                  <i class="fa fa-play"></i>
                </a>
                <div class="videos__large__item__text">
                  <h4>${title}</h4>
                  <ul>
                    <li>${duration}</li>
                    <li>${date}</li>
                  </ul>
                </div>
              </div>
            `;
          } else {
            return `
              <div class="col-lg-3">
                <div class="videos__item">
                  <div class="videos__item__pic set-bg" data-setbg="${thumbnail}">
                    <a href="#" 
                       data-video-title="${title}"
                       data-embed-url="${embedUrl}"
                       class="play-btn video-embed-btn" 
                       title="Reproducir video"
                       data-toggle="modal" 
                       data-target="#videoModal">
                      <i class="fa fa-play"></i>
                    </a>
                  </div>
                  <div class="videos__item__text">
                    <h5>${title}</h5>
                    <ul>
                      <li>${duration}</li>
                      <li>${date}</li>
                    </ul>
                  </div>
                </div>
              </div>
            `;
          }
        }
        async function loadFacebookVideos() {
          const videos = await fetchFacebookVideos();

          if (videos.length === 0) {
            console.log("No videos found or error loading videos");
            // Mostrar mensaje de error en lugar del placeholder
            $("#main-video-container").html(`
              <div class="videos__large__item" style="background: linear-gradient(45deg, #333, #555); min-height: 300px; display: flex; align-items: center; justify-content: center;">
                <div class="videos__large__item__text">
                  <h4>No se pudieron cargar los videos</h4>
                  <ul>
                    <li>00:00</li>
                    <li>Error de conexión</li>
                  </ul>
                  <div style="margin-top: 10px;">
                    <small style="color: #ccc;">Verifica tu conexión a internet</small>
                  </div>
                </div>
              </div>
            `);
            return;
          }

          // Actualizar el video principal (el más reciente)
          const mainVideo = videos[0];
          if (mainVideo) {
            const largeVideoHtml = createVideoElement(mainVideo, true);
            $("#main-video-container").html(largeVideoHtml);
          }

          // Actualizar la galería de videos
          const videoSlider = $(".videos__slider");
          videoSlider.empty(); // Limpiar videos existentes

          // Crear elementos para el resto de videos (excluyendo el principal)
          const galleryVideos = videos.slice(1);
          galleryVideos.forEach((video) => {
            const videoHtml = createVideoElement(video, false);
            videoSlider.append(videoHtml);
          });

          // Reinicializar el carousel después de agregar nuevos elementos
          videoSlider.trigger("destroy.owl.carousel");
          videoSlider.removeClass("owl-carousel owl-loaded");
          videoSlider.find(".owl-stage-outer").children().unwrap();

          // Reinicializar con configuración básica
          videoSlider.addClass("owl-carousel");
          videoSlider.owlCarousel({
            items: 4,
            loop: true,
            margin: 30,
            nav: true,
            navText: [
              '<i class="fa fa-angle-left"></i>',
              '<i class="fa fa-angle-right"></i>',
            ],
            responsive: {
              0: { items: 1 },
              576: { items: 2 },
              768: { items: 3 },
              992: { items: 4 },
            },
          });

          // Reinicializar los backgrounds de las imágenes
          $(".set-bg").each(function () {
            var bg = $(this).data("setbg");
            $(this).css("background-image", "url(" + bg + ")");
          });

          // Configurar Magnific Popup con iframe directo de Facebook
          $(".video-popup").magnificPopup({
            type: "inline",
            mainClass: "mfp-fade",
            removalDelay: 160,
            preloader: false,
            fixedContentPos: false,
            callbacks: {
              beforeOpen: function () {
                const $el = this.st.el;
                const originalUrl = $el.data("original-url");
                const videoId = $el.data("video-id");
                const alternativeUrls = JSON.parse(
                  $el.data("alternative-urls") || "[]"
                );

                console.log("Abriendo video:", originalUrl);
                console.log("Video ID:", videoId);
                console.log("URLs alternativas:", alternativeUrls);

                // Crear modal con múltiples opciones de URL
                let alternativeUrlsHtml = "";
                if (alternativeUrls.length > 0) {
                  alternativeUrls.forEach((url, index) => {
                    alternativeUrlsHtml += `
                      <div style="margin: 5px 0;">
                        <a href="${url}" target="_blank" style="color: #1877F2; text-decoration: none; font-size: 12px;">
                          <i class="fab fa-facebook"></i> Opción ${index + 1}
                        </a>
                      </div>
                    `;
                  });
                }

                const modalContent = `
                  <div id="video-modal-content" class="mfp-hide" style="max-width: 700px; margin: 0 auto; background: #1c1c1c; border-radius: 10px; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 15px;">
                      <h3 style="color: white; margin: 0;">Video de Midnight Rock Band</h3>
                      <p style="color: #ccc; margin: 5px 0;">Si no se carga, prueba las opciones de abajo</p>
                    </div>
                    
                    <!-- Reproductor oficial de Facebook -->
                    <div class="fb-video" 
                         data-href="${originalUrl}" 
                         data-width="560" 
                         data-show-text="false"
                         data-allowfullscreen="true">
                      <div class="fb-xfbml-parse-ignore">
                        <blockquote cite="${originalUrl}">
                          <p>Video de Midnight Rock Band</p>
                          Posted by <a href="https://www.facebook.com/midnightvallarta">Midnight Rock Band</a>
                        </blockquote>
                      </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 15px;">
                      <div style="margin-bottom: 10px;">
                        <a href="${originalUrl}" target="_blank" style="color: #1877F2; text-decoration: none; font-size: 14px; margin: 0 10px;">
                          <i class="fab fa-facebook"></i> URL Original
                        </a>
                      </div>
                      ${alternativeUrlsHtml}
                      
                      <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <small style="color: #ccc; display: block;">
                          Video ID: ${videoId || "No disponible"}
                        </small>
                        <small style="color: #ccc; display: block; margin-top: 5px;">
                          Si ningún enlace funciona, el video puede no ser público o estar restringido
                        </small>
                      </div>
                    </div>
                  </div>
                `;

                // Remover modal anterior si existe
                $("#video-modal-content").remove();

                // Agregar nuevo modal al body
                $("body").append(modalContent);

                // Establecer el elemento para Magnific Popup
                this.st.el.attr("href", "#video-modal-content");
              },
              open: function () {
                // Después de abrir el modal, inicializar el plugin de Facebook
                setTimeout(() => {
                  if (typeof FB !== "undefined") {
                    FB.XFBML.parse(
                      document.getElementById("video-modal-content")
                    );
                  }
                }, 100);
              },
              afterClose: function () {
                // Limpiar modal después de cerrar
                $("#video-modal-content").remove();
              },
            },
          });
        }

        // Cargar videos al inicializar la página
        loadFacebookVideos();

        // Manejar clicks en botones de video embebido
        $(document).on('click', '.video-embed-btn', function(e) {
          e.preventDefault();
          
          const embedUrl = $(this).data('embed-url');
          const videoTitle = $(this).data('video-title');
          
          // Actualizar título del modal
          $('#videoModalLabel').text(videoTitle);
          
          // Mostrar loading mientras se ajustan dimensiones
          $('#video-container').html('<div class="video-loading"><i class="fa fa-spinner fa-spin"></i></div>');
          
          // Función para calcular dimensiones automáticas
          function getOptimalDimensions() {
            const windowWidth = $(window).width();
            const windowHeight = $(window).height();
            
            let modalWidth, videoHeight, modalMargin;
            
            if (windowWidth >= 1201) {
              // Desktop extra grande
              modalWidth = Math.min(windowWidth * 0.75, 1100);
              videoHeight = Math.min(windowHeight * 0.7, 650);
              modalMargin = '2rem auto';
            } else if (windowWidth >= 993) {
              // Desktop grande
              modalWidth = windowWidth * 0.8;
              videoHeight = Math.min(windowHeight * 0.65, 550);
              modalMargin = '1.75rem auto';
            } else if (windowWidth >= 769) {
              // Desktop pequeño/Tablet grande
              modalWidth = windowWidth * 0.85;
              videoHeight = Math.min(windowHeight * 0.6, 500);
              modalMargin = '1.5rem auto';
            } else if (windowWidth >= 577) {
              // Tablet
              modalWidth = windowWidth * 0.95;
              videoHeight = Math.min(windowHeight * 0.55, 400);
              modalMargin = '1rem auto';
            } else {
              // Móvil
              modalWidth = windowWidth * 0.98;
              videoHeight = Math.min(windowHeight * 0.5, 300);
              modalMargin = '0.5rem auto';
            }
            
            return { 
              width: modalWidth, 
              height: Math.max(videoHeight, 250), // Altura mínima
              margin: modalMargin 
            };
          }
          
          // Aplicar dimensiones automáticas
          function applyDimensions() {
            const dimensions = getOptimalDimensions();
            
            // Ajustar modal
            $('.modal-dialog').css({
              'max-width': dimensions.width + 'px',
              'margin': dimensions.margin,
              'transition': 'all 0.3s ease'
            });
            
            return dimensions;
          }
          
          // Obtener dimensiones iniciales
          const dimensions = applyDimensions();
          
          // Crear iframe con dimensiones automáticas
          setTimeout(() => {
            const iframe = `
              <iframe 
                src="${embedUrl}" 
                width="100%" 
                height="${dimensions.height}" 
                style="border:none;overflow:hidden;border-radius:8px;transition:height 0.3s ease;" 
                scrolling="no" 
                frameborder="0" 
                allowfullscreen="true" 
                allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"
                onload="adjustVideoFrame(this)">
              </iframe>
            `;
            
            // Insertar iframe en el modal
            $('#video-container').html(iframe);
            
          }, 500);
          
          // Manejar redimensionamiento de ventana
          $(window).off('resize.videoModal').on('resize.videoModal', function() {
            const newDimensions = applyDimensions();
            $('#video-container iframe').animate({
              height: newDimensions.height
            }, 300);
          });
        });

        // Función global para ajustar el frame automáticamente
        window.adjustVideoFrame = function(iframe) {
          console.log('Video frame cargado, aplicando ajustes automáticos...');
          
          setTimeout(() => {
            const $iframe = $(iframe);
            const windowHeight = $(window).height();
            const modalHeader = $('.modal-header').outerHeight() || 60;
            const availableHeight = windowHeight - modalHeader - 100; // 100px de margin
            
            // Ajustar si la altura calculada es mejor
            if (availableHeight > 250 && availableHeight < $iframe.height()) {
              $iframe.animate({
                height: availableHeight
              }, 500);
              console.log('Altura ajustada automáticamente a:', availableHeight);
            }
            
            // Aplicar efecto de entrada suave
            $iframe.css('opacity', '0').animate({
              opacity: 1
            }, 800);
            
          }, 1000);
        };

        // Limpiar iframe cuando se cierra el modal
        $('#videoModal').on('hidden.bs.modal', function () {
          $('#video-container').html('');
          $(window).off('resize.videoModal');
          
          // Resetear tamaño del modal
          $('.modal-dialog').css({
            'max-width': '',
            'margin': '',
            'transition': ''
          });
        });

        // Ajustar automáticamente cuando se abre el modal
        $('#videoModal').on('shown.bs.modal', function () {
          // Verificar si necesita reajuste después de abrir
          setTimeout(() => {
            const iframe = $('#video-container iframe');
            if (iframe.length && window.adjustVideoFrame) {
              window.adjustVideoFrame(iframe[0]);
            }
          }, 200);
        });

        // Inicializar Facebook SDK cuando esté disponible
        window.fbAsyncInit = function () {
          FB.init({
            xfbml: true,
            version: "v18.0",
          });
        };
      });
    </script>
  </body>
</html>
